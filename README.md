## 开发

以 CSR 方式开发：
```bash
# 启动 client 入口文件打包
$ npm run dev:client
```

以 SSR 方式开发：
```bash
# 启动 ssr 入口文件打包
$ npm run dev:ssr

# 启动服务器
$ npm run dev:server
```

如果涉及到一些需要在服务器构建阶段就需要请求的数据，则需要在服务器端程序里面写业务代码，其实这样耦合过重。

可以后面约定一套行之有效的规则，将服务器部分部署到云端，是单独一个项目控制更新的，包括服务器端的各个业务模块。在开发阶段可以通过代理，映射到本地文件夹，然后 rpc 这些请求部分可以通过一个测试环境的 proxy 去代理转发到测试环境业务服务。但是如果服务端业务代码比较负责或者过重的话，其实还是得开发完部署到测试服务器，或者直接就是用 vscode 的远程开发功能，直接在开发服务器上开发调试。

## 打包构建

以 CSR 方式构建：
```bash
$ npm run build:client
```

以 SSR 方式构建：
```bash
$ npm run build:ssr
```

说明一下 SSR 方式的构建，一共有几个步骤：
1. `entry` 需要同时包含 CSR 和 SSR 的入口文件，因为首次 SSR 呈现之后，后续的交互还是要靠 CSR 入口构建出来的代码；
2. 模板 html 文件需要包含用于 SSR 的一些占位符； 
3. 服务端代码匹配路由，在命中回调中读取 html 模板，并替换占位符，再打成字符串，发送给客户端。

## 总结

在这个阶段其实可以清晰地认识到，服务器代码和前端构建的代码是分开部署的，前端构建出来的代码可以同时上传到 CDN 和业务服务器同一根目录下，然后通过域名配置对应的域名解析服务，检测到服务器直出负载过高时，自动切换到 CDN，然后拉取 CSR 方式构建的代码，直接到前端渲染，这样就实现了完美的降级策略。